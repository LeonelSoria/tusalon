<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Servicio - TuSalón</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">TuSalón</a>
            <div class="nav-links">
                <a href="index.html">Inicio</a>
                <a href="salones.html">Salones</a>
                <a href="servicios.html">Servicios</a>
            </div>
            <div class="nav-actions">
                <a href="login.html" class="btn btn-outline">Ingresar</a>
                <a href="register.html" class="btn btn-primary">Registrarse</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="detail-hero">
        <div class="container">
            <a href="servicios.html" class="back-link">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Volver a Servicios
            </a>
            <div class="service-badge" id="serviceBadge"></div>
            <h1 id="serviceName" class="detail-title">Cargando...</h1>
            <div id="serviceLocation" class="detail-subtitle"></div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="detail-content">
        <div class="container">
            <div class="detail-grid">
                <!-- Left Column: Images & Details -->
                <div class="detail-main">
                    <!-- Image Gallery -->
                    <div class="image-gallery" id="imageGallery">
                        <div class="gallery-main">
                            <img id="mainImage" src="" alt="Imagen del servicio">
                            <button class="gallery-nav gallery-prev" onclick="previousImage()">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </button>
                            <button class="gallery-nav gallery-next" onclick="nextImage()">
                                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="gallery-thumbnails" id="thumbnails"></div>
                    </div>

                    <!-- Description -->
                    <div class="detail-section">
                        <h2>Descripción</h2>
                        <p id="serviceDescription"></p>
                    </div>

                    <!-- Features -->
                    <div class="detail-section">
                        <h2>Detalles del Servicio</h2>
                        <div class="features-grid" id="featuresGrid">
                            <div class="feature-item">
                                <svg class="feature-icon" width="24" height="24" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                                    </path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span id="serviceAddress"></span>
                            </div>
                        </div>
                        <div id="serviceExperience" class="service-experience" style="margin-top: 1.5rem;"></div>
                    </div>

                    <!-- Location -->
                    <div class="detail-section">
                        <h2>Zona de Cobertura</h2>
                        <div id="mapContainer" class="map-container">
                            <div class="map-placeholder">
                                <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                                    </path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <p>Mapa de ubicación</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Booking Card -->
                <div class="detail-sidebar">
                    <div class="booking-card">
                        <div class="price-section">
                            <span class="price-label">Precio desde</span>
                            <span class="price" id="servicePrice"></span>
                        </div>

                        <div class="divider"></div>

                        <!-- Provider Info -->
                        <div class="provider-info">
                            <h3>Proveedor</h3>
                            <div id="proveedorInfo" class="provider-details"></div>
                        </div>

                        <div class="divider"></div>

                        <!-- Contact Form -->
                        <div class="contact-section">
                            <h3>Enviar Consulta</h3>
                            <form id="inquiryForm" class="inquiry-form">
                                <div class="form-group">
                                    <label for="eventDate">Fecha del Evento</label>
                                    <input type="date" id="eventDate" name="eventDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="message">Mensaje</label>
                                    <textarea id="message" name="message" rows="4"
                                        placeholder="Describe tu necesidad..." required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block">
                                    Enviar Consulta
                                </button>
                            </form>
                        </div>

                        <!-- Add to Favorites -->
                        <button id="favoriteBtn" class="btn btn-outline btn-block" style="margin-top: 1rem;">
                            <svg id="heartIcon" width="20" height="20" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                                </path>
                            </svg>
                            <span id="favoriteText">Agregar a Favoritos</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 TuSalón. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script>
        const API_URL = 'http://localhost:3000/api/v1';
        let currentService = null;
        let currentImageIndex = 0;
        let images = [];

        // Service type translations
        const serviceTypes = {
            'fotografia': 'Fotografía',
            'dj': 'DJ',
            'wedding_planner': 'Wedding Planner',
            'catering': 'Catering',
            'decoracion': 'Decoración',
            'musica': 'Música',
            'video': 'Video',
            'flores': 'Flores',
            'transporte': 'Transporte',
            'animacion': 'Animación',
            'otros': 'Otros'
        };

        // Get service ID from URL
        function getServiceId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Load service details
        async function loadServiceDetails() {
            const serviceId = getServiceId();

            if (!serviceId) {
                alert('ID de servicio no especificado');
                window.location.href = 'servicios.html';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/servicios/${serviceId}`);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'Error al cargar el servicio');
                }

                currentService = result.data;
                displayServiceDetails(currentService);
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar los detalles del servicio');
                window.location.href = 'servicios.html';
            }
        }

        // Display service details
        function displayServiceDetails(service) {
            // Service type badge
            document.getElementById('serviceBadge').textContent = serviceTypes[service.tipo] || service.tipo;

            // Title and location
            document.getElementById('serviceName').textContent = service.nombre;
            document.getElementById('serviceLocation').textContent = `${service.ciudad}, ${service.provincia}`;

            // Images
            images = service.imagenes ? JSON.parse(service.imagenes) : ['https://via.placeholder.com/800x600?text=Sin+imagen'];
            displayImages();

            // Description
            document.getElementById('serviceDescription').textContent = service.descripcion || 'Sin descripción disponible';

            // Address
            document.getElementById('serviceAddress').textContent = `${service.ciudad}, ${service.provincia}, ${service.pais || 'Argentina'}`;

            // Experience
            if (service.experiencia) {
                document.getElementById('serviceExperience').innerHTML = `
                    <strong>Experiencia:</strong>
                    <p>${service.experiencia}</p>
                `;
            }

            // Price
            const precio = service.precioDesde ? `$${parseInt(service.precioDesde).toLocaleString('es-AR')}` : 'Consultar';
            document.getElementById('servicePrice').textContent = precio;

            // Provider info
            if (service.proveedor) {
                document.getElementById('proveedorInfo').innerHTML = `
                    <p><strong>${service.proveedor.nombre} ${service.proveedor.apellido || ''}</strong></p>
                    <p>${service.proveedor.email}</p>
                    ${service.proveedor.telefono ? `<p>${service.proveedor.telefono}</p>` : ''}
                `;
            }
        }

        // Display images in gallery
        function displayImages() {
            if (images.length === 0) return;

            const mainImage = document.getElementById('mainImage');
            mainImage.src = images[currentImageIndex];

            const thumbnails = document.getElementById('thumbnails');
            thumbnails.innerHTML = images.map((img, index) => `
                <img src="${img}" alt="Imagen ${index + 1}" 
                     class="${index === currentImageIndex ? 'active' : ''}"
                     onclick="setCurrentImage(${index})">
            `).join('');
        }

        // Navigate images
        function previousImage() {
            currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
            displayImages();
        }

        function nextImage() {
            currentImageIndex = (currentImageIndex + 1) % images.length;
            displayImages();
        }

        function setCurrentImage(index) {
            currentImageIndex = index;
            displayImages();
        }

        // Handle inquiry form submission
        document.getElementById('inquiryForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!AuthManager.isAuthenticated()) {
                alert('Debes iniciar sesión para enviar una consulta');
                window.location.href = 'login.html';
                return;
            }

            const formData = {
                servicioId: currentService.id,
                fechaEvento: document.getElementById('eventDate').value,
                mensaje: document.getElementById('message').value,
            };

            try {
                const response = await AuthManager.fetchWithAuth(`${API_URL}/consultas`, {
                    method: 'POST',
                    body: JSON.stringify(formData),
                });

                const result = await response.json();

                if (result.success) {
                    alert('¡Consulta enviada correctamente! El proveedor se pondrá en contacto contigo.');
                    document.getElementById('inquiryForm').reset();
                } else {
                    throw new Error(result.error || 'Error al enviar consulta');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al enviar la consulta. Por favor intenta de nuevo.');
            }
        });

        // Handle favorite button
        document.getElementById('favoriteBtn').addEventListener('click', async () => {
            if (!AuthManager.isAuthenticated()) {
                alert('Debes iniciar sesión para agregar a favoritos');
                window.location.href = 'login.html';
                return;
            }

            alert('Función de favoritos en desarrollo');
        });

        // Load service on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadServiceDetails();
        });
    </script>
</body>

</html>